<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Chỉnh sửa người dùng - Admin</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,600,700,800" rel="stylesheet" />
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/nucleo-icons.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/black-dashboard.min.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/theme-switcher.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/admin_dashboard.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/add_user.css') }}" rel="stylesheet" />
  <link href="{{ url_for('static', filename='js/assets/css/edit_user.css') }}" rel="stylesheet" />
</head>
<body>
  <div class="admin-wrapper">
    <nav class="navbar navbar-expand-lg navbar-absolute" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <div class="container-fluid">
        <div class="d-flex align-items-center">
          <a class="btn btn-sm btn-outline-light me-2" href="/admin"><i class="fas fa-arrow-left"></i> Quay lại</a>
        </div>
        <div class="d-flex align-items-center ms-auto">
          <div class="form-check form-switch text-white">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label ms-2" for="themeToggle"><i id="themeIcon" class="fas fa-moon"></i></label>
          </div>
        </div>
      </div>
    </nav>

    <div class="admin-content">
      <div class="container-fluid py-4">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="admin-card shadow-lg-soft add-user-card mx-auto">
              <div class="card-body">
                <div class="row">
                  <div class="col-12 col-lg-4 mb-4 mb-lg-0">
                    <div class="user-summary card p-4 h-100 text-center">
                      <div id="userAvatar" class="avatar-large mb-3">A</div>
                      <h4 id="summaryName" class="mb-1">--</h4>
                      <div id="roleBadge" class="badge bg-secondary mb-2">role</div>
                      <div class="small text-muted">ID: <span id="displayUserId">{{ user_id }}</span></div>
                      <hr>
                      <div class="text-start small text-muted">
                        <div>Đăng ký: <span id="createdAt">—</span></div>
                        <div>Cập nhật: <span id="updatedAt">—</span></div>
                        <div>Email: <span id="summaryEmail">—</span></div>
                      </div>
                    </div>
                  </div>

                  <div class="col-12 col-lg-8">
                    <h3 class="mb-3">Chỉnh sửa thông tin</h3>
                    <div id="formAlert" class="alert d-none" role="alert"></div>
                    <form id="editUserForm">
                      <input type="hidden" id="editUserId" value="{{ user_id }}">
                      <div class="row g-3">
                        <div class="col-12">
                          <label for="editUserName" class="form-label">Tên hiển thị</label>
                          <input type="text" class="form-control" id="editUserName" placeholder="Họ và tên" required>
                          <div id="editUserNameFeedback" class="invalid-feedback" style="display:none;"></div>
                        </div>

                        <div class="col-12">
                          <label for="editUserEmail" class="form-label">Email</label>
                          <input type="email" class="form-control" id="editUserEmail" placeholder="user@example.com" required>
                          <div id="editUserEmailFeedback" class="invalid-feedback" style="display:none;"></div>
                        </div>

                        <div class="col-12 col-md-6">
                          <label for="editUserRole" class="form-label">Vai trò</label>
                          <input type="text" id="editUserRole" class="form-control" readonly title="Vai trò không được chỉnh sửa từ giao diện này.">
                        </div>

                        <div class="col-12 col-md-6 d-flex align-items-center">
                          <label for="editUserStatus" class="form-label me-3 mb-0">Trạng thái</label>
                          <select id="editUserStatus" name="status" class="form-select w-auto">
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Không hoạt động</option>
                          </select>
                        </div>
                      </div>

                      <div class="d-flex gap-2 mt-3 action-row">
                        <button type="button" class="btn btn-success" id="saveBtn">Lưu</button>
                        <span id="saveStatus" style="display:none; margin-left:0.5rem; align-self:center; font-size:.95rem; color:#adb5bd;">Đang lưu...</span>
                        <a href="/admin" class="btn btn-outline-secondary">Hủy</a>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/assets/js/core/jquery.min.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/assets/edit_user.js') }}"></script>

  <script>
    // initialize theme toggle to match other admin pages
    document.addEventListener('DOMContentLoaded', function() {
      try {
        const saved = localStorage.getItem('adminTheme');
        const themeToggle = document.getElementById('themeToggle');
        const adminWrapper = document.querySelector('.admin-wrapper');
        const icon = document.getElementById('themeIcon');
        if (saved === 'light') {
          themeToggle.checked = false;
          adminWrapper.classList.add('light-mode');
          document.body.classList.add('white-content');
          icon.className = 'fas fa-sun';
        } else {
          themeToggle.checked = true;
          adminWrapper.classList.remove('light-mode');
          document.body.classList.remove('white-content');
          icon.className = 'fas fa-moon';
        }
        themeToggle.addEventListener('change', function() {
          if (themeToggle.checked) {
            localStorage.removeItem('adminTheme');
            adminWrapper.classList.remove('light-mode');
            document.body.classList.remove('white-content');
            icon.className = 'fas fa-moon';
          } else {
            localStorage.setItem('adminTheme', 'light');
            adminWrapper.classList.add('light-mode');
            document.body.classList.add('white-content');
            icon.className = 'fas fa-sun';
          }
        });
      } catch (e) {
        // noop
      }
    });
  </script>
</body>
</html>